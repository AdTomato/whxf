<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.authine.cloudpivot.web.api.mapper.RoleVacationInfoMapper">

    <!--2020-06-03 weiyao获取角色Id-->
    <select id="getddRoleId" resultType="java.lang.String">
        SELECT sourceId
        FROM h_org_role
        where name = #{name}
        LIMIT 1
    </select>

    <select id="getTodayCount" resultType="java.lang.Integer">
        SELECT count(*)
        FROM i4h9w_roleVacationInfo
     WHERE TO_DAYS(vacationDate) =TO_DAYS(NOW())
    </select>

    <!-- 批量插入请假人员详情子表 -->
    <insert id="insertVacationDetailList" parameterType="java.util.List">
        INSERT INTO i4h9w_vacationDetail
        (id,vacationName,userId,parentId,sortKey)
        VALUES
        <foreach collection="list" item="item" index="index" separator=",">
            (#{item.id},#{item.vacationName},#{item.userId},#{item.parentId},#{item.sortKey})
        </foreach>

    </insert>

    <!-- 插入请假信息主表 -->
    <insert id="insertRoleVacation" parameterType="com.authine.cloudpivot.web.api.entity.RoleVacationInfo">
        INSERT INTO i4h9w_roleVacationInfo
       (id, name, creater, createdDeptId, owner, ownerDeptId, createdTime,
            modifier,modifiedTime, workflowInstanceId,
            sequenceNo, sequenceStatus,ownerDeptQueryCode,
            roleName,vacationDate,allroleNum,vacationNum,inworkNum)
        VALUES (#{id}, #{name}, #{creater}, #{createdDeptId}, #{owner}, #{ownerDeptId},
                now(), #{modifier}, now(), #{workflowInstanceId},
                #{sequenceNo},#{sequenceStatus}, #{ownerDeptQueryCode},
                #{roleName}, now(), #{allroleNum}, #{vacationNum}, #{inworkNum})
    </insert>
</mapper>